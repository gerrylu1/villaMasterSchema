$id: https://raw.githubusercontent.com/thanakijwanavit/villaMasterSchema/master/coupon/coupon.yaml
$schema: https://json-schema.org/draft/2020-12/schema
definitions:
  Condition:
    title: Condition
    type: object
    properties:
      cannotUseWith:
        description: couponIds that this coupon cannot be used with
        type: array
        items:
          type: integer
      cartTotal:
        description: condition on the total amount of the cart
        type: object
        properties:
          operator: 
            type: string
            enum:
              - >=
          amount:
            type: number
          exclude:
            description: cprcode or groupIds that cannot count into cart total
            type: array
            items: 
              type: integer
      product:
        description: condition on the product quantity in the cart
        type: object
        properties:
          productList:
            description: cprcodes or groupIds of eligible products
            type: array
            items:
              type: integer
          operator: 
            type: string
            enum:
              - >=
              - ==
          amount:
            type: integer
    
  Action:
    title: Action
    type: object
    description: actions applied by this coupon
    properties:
      discount:
        description: discount to apply to cart/product
        type: object
        properties:
          discountType:
            type: string
            enum:
              - VALUE
              - PERCENT
      getFreeProduct:
        description: products for customer to choose for BOGO coupons
        type: object
        properties:
          products:
            description: cprcodes or groupIds of products to choose from
            type: array
            items:
              type: integer
          amount:
            type: integer
      freeShipping:
        type: boolean



type: object
required:
  - couponId
  - couponName
  - active
  - actions
properties:
  couponId:
    type: integer
    description: id of the coupon
  couponName:
    type: string
    description: name of the coupon
  couponDescription:
    type: string
    description: description of the coupon
  active:
    type: boolean
  couponCodeType:
    type: string
    enum: 
      - FIXED
      - AUTO_GENERATED
      - NO_CODE
  usesPerCoupon:
    type: integer
    description: total number of times this coupon can be used 
  usesPerCustomer:
    type: integer 
  startDate:
    type: integer
  endDate:
    type: integer
  conditions:
    description: cart/product conditions for actions in this coupon to apply. if not specified, automatically apply actions. 
    $ref: '#/definitions/Condition'
  actions:
    $ref: '#/definitions/Action'
  customers:
    type: array
    description: list of customerIds or customer group Ids who are eligible for this coupon. if not specified, coupon applies to all customers. 
    items:
      type: integer
  customerTypes:
    type: array
    description: customer types that are eligible for this coupon. if not specified, coupon applies to all customerTypes.
    items:
      type: string
      pattern: '(^\d{2}$)'
  branches:
    type: array
    description: list of branchIds that are eligible for this coupon. if not specified, coupon applies to all branches.
    items:
      type: string


  